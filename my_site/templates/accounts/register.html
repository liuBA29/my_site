
<!-- accounts/register.html  -->
{# templates/accounts/register.html #}
{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Register | Portfolio website of web developer Liubov Kovaleva" %}{% endblock %}
{% block meta_description %}
  {% trans "Registration page for the portfolio website of web developer Liubov Kovaleva. Django, Python, tools, freelance projects." %}
{% endblock %}
{% block og_title %}{% trans "Register | Liubov Kovaleva Portfolio" %}{% endblock %}
{% block og_description %}
  {% trans "Create an account to use tools and access features on Liubov Kovaleva‚Äôs developer portfolio site." %}
{% endblock %}

{% block content %}

<h2>{% trans "Register" %}</h2>


<form method="post" novalidate class="login-form" id="register-form">
    {% csrf_token %}
    <p>
        <label for="{{ form.username.id_for_label }}">{% trans "Username" %}:</label>
        {{ form.username }}
        {% if form.username.errors %}
            <span class="error">{{ form.username.errors }}</span>
        {% endif %}
    </p>
    <p>
        <label for="{{ form.email.id_for_label }}">{% trans "Email" %}:</label>
        {{ form.email }}
        {% if form.email.errors %}
            <span class="error">{{ form.email.errors }}</span>
        {% endif %}
    </p>
    <p>
        <label for="{{ form.password1.id_for_label }}">{% trans "Password" %}:</label>
        {{ form.password1 }}
        {% if form.password1.errors %}
            <span class="error">{{ form.password1.errors }}</span>
        {% endif %}
    </p>
    <p>
        <label for="{{ form.password2.id_for_label }}">{% trans "Confirm password" %}:</label>
        {{ form.password2 }}
        {% if form.password2.errors %}
            <span class="error">{{ form.password2.errors }}</span>
        {% endif %}
    </p>
    <p>
        {% if CLOUDFLARE_TURNSTILE_SITE_KEY %}
            <label>{% trans "Verification" %}:</label>
            <div class="cf-turnstile" 
                 data-sitekey="{{ CLOUDFLARE_TURNSTILE_SITE_KEY }}" 
                 data-theme="light"
                 data-callback="turnstileCallback"
                 data-error-callback="turnstileErrorCallback"></div>
            <small class="form-hint">{% trans "Please complete the verification above" %}</small>
        {% else %}
            <div class="alert-warning-box">
                <strong>‚ö†Ô∏è {% trans "Warning" %}:</strong> {% trans "Cloudflare Turnstile is not configured. Registration is not protected from bots." %}
            </div>
        {% endif %}
        {{ form.cf_turnstile_response }}
        {% if form.cf_turnstile_response.errors %}
            <span class="error">{{ form.cf_turnstile_response.errors }}</span>
        {% endif %}
    </p>
    <button type="submit" class="login-button">{% trans "Register" %}</button>
</form>

<p>{% trans "Already have an account?" %}
  <a class="simple-link" href="{% url 'accounts:login' %}">{% trans "Login" %}</a>
</p>

{% endblock %}

{% block extra_js %}
{% if CLOUDFLARE_TURNSTILE_SITE_KEY %}
<!-- Cloudflare Turnstile -->
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('register-form');
    const turnstileInput = document.querySelector('input[name="cf_turnstile_response"]');
    const turnstileWidget = document.querySelector('.cf-turnstile');
    
    console.log('üîç Cloudflare Turnstile Debug:');
    console.log('Site Key:', '{{ CLOUDFLARE_TURNSTILE_SITE_KEY }}');
    console.log('Form found:', !!form);
    console.log('Turnstile input found:', !!turnstileInput);
    console.log('Turnstile widget found:', !!turnstileWidget);
    
    if (form && turnstileInput && turnstileWidget) {
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ Turnstile
        window.turnstileCallback = function(token) {
            console.log('‚úÖ Turnstile verification successful! Token:', token.substring(0, 20) + '...');
            turnstileInput.value = token;
        };
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–∫–∏ Turnstile
        window.turnstileErrorCallback = function() {
            console.log('‚ùå Turnstile verification failed!');
            turnstileInput.value = '';
        };
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
        form.addEventListener('submit', function(e) {
            console.log('üì§ Form submit attempt. Token present:', !!turnstileInput.value);
            if (!turnstileInput.value || turnstileInput.value === '') {
                console.log('‚ö†Ô∏è Blocking form submission - no Turnstile token');
                e.preventDefault();
                alert('{% trans "Please complete the verification." %}');
                return false;
            }
            console.log('‚úÖ Form submission allowed - Turnstile token present');
        });
    } else {
        console.warn('‚ö†Ô∏è Turnstile elements not found!');
    }
});
</script>
{% else %}
<script>
console.log('‚ö†Ô∏è Cloudflare Turnstile Site Key not configured!');
console.log('Add CLOUDFLARE_TURNSTILE_SITE_KEY to your .env file');
</script>
{% endif %}
{% endblock %}
