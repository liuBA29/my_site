<!-- templates/main_app/contacts.html -->
{% extends 'base.html' %}
{% load i18n %}
{% block title %}{% trans "Contacts" %}{% endblock %}

{% block content %}
  {% if messages %}
    <div class="page-messages">
      {% for message in messages %}
        {% if 'success' in message.tags %}
          <div class="page-message success">
            {{ message }}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  {% endif %}

  <h1>{% trans "My contacts" %}</h1>

  <p class="section-description">
    <span>Email: luba.sentino@gmail.com</span><br>
    <span>Telegram: @liubakovaleva</span><br>
    <a href="#" id="open-chat" class="soft-item-link"><span>{% trans "Chat-online" %}</span></a><br>
    {% if not user.is_authenticated %}
    <span><a href="{% url 'accounts:login' %}" class="auth-link-inline">{% trans "Login" %}</a> | <a href="{% url 'accounts:register' %}" class="auth-link-inline">{% trans "Register" %}</a></span><br>
    {% endif %}
  </p>

  <!-- Модальное окно -->
  <div id="chatModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <div id="chatContent">{% trans "Loading..." %}</div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const modal = document.getElementById('chatModal');
      const openBtn = document.getElementById('open-chat');
      const closeBtn = modal.querySelector('.close');
      const chatContent = document.getElementById('chatContent');

      openBtn.addEventListener('click', function (e) {
        e.preventDefault();
        modal.style.display = 'block';
        document.body.classList.add('modal-open');

        fetch("{% url 'chat:lobby' %}?partial=1")
          .then(response => response.text())
          .then(html => {
            chatContent.innerHTML = html;
            const scriptTags = chatContent.querySelectorAll("script");
            scriptTags.forEach(oldScript => {
              const newScript = document.createElement("script");
              newScript.text = oldScript.text;
              document.body.appendChild(newScript);
            });
          });
      });

      closeBtn.addEventListener('click', function () {
        modal.style.display = 'none';
        document.body.classList.remove('modal-open');
        chatContent.innerHTML = '';
      });

      window.addEventListener('click', function (e) {
        if (e.target === modal) {
          modal.style.display = 'none';
          document.body.classList.remove('modal-open');
          chatContent.innerHTML = '';
        }
      });
    });
  </script>
{% endblock %}
