{% extends 'contract_maker/base_contract.html' %}

{% block title %}Список договоров{% endblock %}

{% block content %}
<div class="contract-maker-form">
    <h1 class="contract-maker-title">Договоры и акты</h1>
    <p class="contract-maker-intro">
        <a href="{% url 'contract_maker:form' %}">Создать договор</a> —
        <a href="{% url 'contract_maker:act_for_contract' %}">Сформировать акт</a> —
        <a href="{% url 'contract_maker:contract_add_manual' %}">Добавить договор/акт вручную (PDF)</a>
    </p>

    {% if messages %}
    <ul class="messages contract-maker-messages">
        {% for message in messages %}
        <li class="{{ message.tags }}">{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if contracts %}
    <table class="contract-list-table">
        <thead>
            <tr>
                <th>Договор</th>
                <th>Клиент</th>
                <th>Сумма</th>
                <th>Документы</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for c in contracts %}
            <tr>
                <td>№ {{ c.contract_number }} от {{ c.doc_date }}</td>
                <td>{% if c.customer %}{{ c.customer.org_name }}{% elif c.customer_data %}{{ c.customer_data.org_name }}{% else %}—{% endif %}</td>
                <td>{{ c.total_cost }} руб.</td>
                <td class="contract-list-docs">
                    {% if c.contract_filename %}
                    <a href="{% url 'contract_maker:download' filename=c.contract_filename %}?inline=1" target="_blank" rel="noopener">Договор</a>
                    {% else %}—{% endif %}
                    {% if c.act_filename %}
                    | <a href="{% url 'contract_maker:download' filename=c.act_filename %}?inline=1" target="_blank" rel="noopener">Акт</a>
                    {% endif %}
                </td>
                <td class="contract-list-actions">
                    <a href="{% url 'contract_maker:contract_edit' pk=c.pk %}" class="cm-btn cm-btn-small">Изменить</a>
                    <a href="{% url 'contract_maker:contract_delete' pk=c.pk %}" class="cm-btn cm-btn-small cm-btn-danger">Удалить</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="no-contracts-msg">Нет сохранённых договоров. <a href="{% url 'contract_maker:form' %}">Создать договор</a>.</p>
    {% endif %}
</div>
{% endblock %}
