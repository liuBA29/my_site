<!-- base.html -->

{% load static %}
{% load i18n %}

<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% trans "Portfolio website of Liubov Kovaleva" %}{% endblock %}</title>
    <link rel="icon" type="image/png" href="https://res.cloudinary.com/dczzlelzw/image/upload/v1747063141/df83zssh8bli1agpk9bw.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&family=Source+Sans+3:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <link id="site-style" rel="stylesheet" href="{% static 'CSS/styles.css' %}">
    {% block extra_css %}{% endblock %}
    <script>
    (function() {
        // Определяем модель устройства Apple и применяем соответствующие стили
        // Для СТАРЫХ моделей iPhone/iPad применяем упрощенные стили styles_light.css
        // Для НОВЫХ моделей используем styles.css
        var ua = navigator.userAgent || navigator.vendor || window.opera;
        var isiOS = /iPad|iPhone|iPod/.test(ua) && !window.MSStream;
        
        if (isiOS) {
            var useLightStyles = false;
            
            // Проверяем iPod - всегда старые устройства
            if (/iPod/.test(ua)) {
                useLightStyles = true;
            }
            // Проверяем iPhone по модели (номер в User-Agent)
            else if (/iPhone/.test(ua)) {
                var modelMatch = ua.match(/iPhone(\d+),(\d+)/);
                if (modelMatch) {
                    var modelNumber = parseInt(modelMatch[1], 10);
                    // iPhone 12 и старше (модели 13 и ниже) - используем упрощенные стили
                    // iPhone 13 и новее (модели 14 и выше) - используем полные стили
                    if (modelNumber <= 13) {
                        useLightStyles = true;
                    }
                } else {
                    // Если не удалось определить модель, используем упрощенные стили для безопасности
                    useLightStyles = true;
                }
            }
            // Проверяем iPad
            else if (/iPad/.test(ua)) {
                // Для iPad проверяем модель аналогично iPhone
                var ipadModelMatch = ua.match(/iPad(\d+),(\d+)/);
                if (ipadModelMatch) {
                    var ipadModelNumber = parseInt(ipadModelMatch[1], 10);
                    // iPad до 13-го поколения включительно - упрощенные стили
                    if (ipadModelNumber <= 13) {
                        useLightStyles = true;
                    }
                } else {
                    // Старые iPad без номера модели - упрощенные стили
                    // Также проверяем через OS версию как fallback для очень старых
                    var iOSVersionMatch = ua.match(/OS (\d+)[._](\d+)/);
                    if (iOSVersionMatch) {
                        var iOSVersion = parseFloat(iOSVersionMatch[1] + '.' + iOSVersionMatch[2]);
                        if (iOSVersion < 13.0) {
                            useLightStyles = true;
                        }
                    } else {
                        useLightStyles = true;
                    }
                }
            }
            
            // Применяем стили
            if (useLightStyles) {
                var link = document.getElementById('site-style');
                if (link) {
                    link.href = "{% static 'CSS/styles_light.css' %}";
                }
            }
            // Для новых устройств используем styles.css (по умолчанию)
        }
    })();
    </script>

    <meta name="description" content="{% block meta_description %}{% trans "Portfolio of web developer Liubov Kovaleva: projects, useful utilities, contact for collaboration." %}{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}{% if seo_keywords %}{{ seo_keywords }}{% else %}{% trans "web development, Python, Django, portfolio, freelancer, Liubov Kovaleva, website development" %}{% endif %}{% endblock %}">
    <meta name="author" content="Liubov Kovaleva">
    <meta name="robots" content="index, follow">

    <!-- Canonical URL -->
    <link rel="canonical" href="{% block canonical_url %}{{ request.build_absolute_uri }}{% endblock %}">

    <!-- Open Graph -->
    <meta property="og:title" content="{% block og_title %}{% trans "Portfolio of Liubov Kovaleva" %}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{% trans "Web development, projects, task automation. Portfolio site of LiuBA29." %}{% endblock %}">
    <meta property="og:image" content="{% block og_image %}https://res.cloudinary.com/dczzlelzw/image/upload/v1742906472/face1-re_y281rk.png{% endblock %}">
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:site_name" content="{% trans "Liubov Kovaleva Portfolio" %}">
    <meta property="og:locale" content="{% if LANGUAGE_CODE == 'ru' %}ru_RU{% else %}en_US{% endif %}">
    {% get_available_languages as LANGUAGES %}
    {% for lang_code, lang_name in LANGUAGES %}
    <meta property="og:locale:alternate" content="{% if lang_code == 'ru' %}ru_RU{% else %}en_US{% endif %}">
    {% endfor %}

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block twitter_title %}{% trans "Portfolio of Liubov Kovaleva" %}{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}{% trans "Web development, projects, task automation. Portfolio site of LiuBA29." %}{% endblock %}">
    <meta name="twitter:image" content="{% block twitter_image %}https://res.cloudinary.com/dczzlelzw/image/upload/v1742906472/face1-re_y281rk.png{% endblock %}">

    <!-- Hreflang для мультиязычности -->
    {% for lang_code, lang_name in LANGUAGES %}
    <link rel="alternate" hreflang="{{ lang_code }}" href="{% block hreflang_url %}{{ request.build_absolute_uri }}{% endblock %}">
    {% endfor %}
    <link rel="alternate" hreflang="x-default" href="{{ request.build_absolute_uri }}">

    <!-- Структурированные данные JSON-LD -->
    {% block structured_data %}{% endblock %}

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Google Analytics -->
    {% if GOOGLE_ANALYTICS_ID %}
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ GOOGLE_ANALYTICS_ID }}"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '{{ GOOGLE_ANALYTICS_ID }}');
    </script>
    {% endif %}




</head>


<body class="light-theme">

<div class="preheader">
   <div class="left-controls">
       <a href="{% url 'main_app:home' %}" class="name-logo">
          <span class="first-name">LIUBOV</span>
          <span class="last-name">Kovaleva</span>
        </a>
   </div>

   <div class="center-controls">
       <a href="{% url 'main_app:order_request' %}" class="order-link">{% trans "Submit a request" %}</a>
   </div>

    <div class="right-controls">

     <form action="{% url 'set_language' %}" method="post">
            {% csrf_token %}
            <input name="next" type="hidden" value="{{ redirect_to }}">
            <div class="language-buttons">
                {% get_current_language as LANGUAGE_CODE %}
                {% get_available_languages as LANGUAGES %}
                {% get_language_info_list for LANGUAGES as languages %}
                {% for language in languages %}
                    <button type="submit" name="language" value="{{ language.code }}" class="language-button{% if language.code == LANGUAGE_CODE %} active{% endif %}">
                        {{ language.code|upper }}
                    </button>
                {% endfor %}
            </div>

        </form>



<form action="#" class="theme-switcher-form" aria-label="{% trans 'Theme' %}">
                <span class="theme-icon theme-icon-sun" title="{% trans 'Light theme' %}" aria-hidden="true"><i class="fas fa-sun"></i></span>
                <label class="toggle" for="themeToggle">
                    <input class="toggle__input" type="checkbox" id="themeToggle">
                    <span class="toggle__fill"></span>
                </label>
                <span class="theme-icon theme-icon-moon" title="{% trans 'Dark theme' %}" aria-hidden="true"><i class="fas fa-moon"></i></span>
            </form>

     <!-- block authentication -->
<div class="auth">
    <nav>
        {% if user.is_authenticated %}
            {% trans "Hello" %}, <strong>{{ user.username }}</strong>
            <a class="logout" href="{% url 'accounts:logout' %}">| {% trans "Logout" %}</a>
        {% else %}
            <a href="{% url 'accounts:register' %}">{% trans "Register" %}</a> |
            <a href="{% url 'accounts:login' %}">{% trans "Login" %}</a>
        {% endif %}
    </nav>
</div>
<!-- end block authentication -->



</div>
</div>


    <header>

        <div class="container">


            <nav>
                <ul>
                    <li>

              <a href="{% url 'main_app:home' %}" id="logo-link">
                <img id="logo-img" class="header-logo-img"
                     src="{% if request.resolver_match.url_name == 'home' %}https://res.cloudinary.com/dczzlelzw/image/upload/v1751985098/uxqacxdfkqeq9l12gbv4.png{% else %}https://res.cloudinary.com/dczzlelzw/image/upload/v1742906472/face1-re_y281rk.png{% endif %}"
                     alt="{% trans 'About me' %}">
              </a>

                    </li>
                    <li><a href="{% url 'main_app:free_soft' %}" class="{% if request.resolver_match.url_name == 'free_soft' or request.resolver_match.url_name == 'free_soft_detail' %}active{% endif %}">{% trans "Free" %}</a></li>
                    <li><a href="{% url 'main_app:cooperation' %}" class="{% if request.resolver_match.url_name == 'cooperation' %}active{% endif %}">{% trans "Cooperation" %}</a></li>
                    <li><a href="{% url 'main_app:business_soft' %}" class="{% if request.resolver_match.url_name == 'business_soft' or request.resolver_match.url_name == 'business_soft_detail' %}active{% endif %}">{% trans "Business products" %}</a></li>
                    <li><a href="{% url 'main_app:contact' %}" class="{% if request.resolver_match.url_name == 'contact' %}active{% endif %}">{% trans "Contacts" %}</a></li>
                    {% if user.is_staff or user.is_superuser %}
                    <li><a href="{% url 'contract_maker:form' %}" class="{% if request.resolver_match.namespace == 'contract_maker' %}active{% endif %}">{% trans "Contracts" %}</a></li>
                    {% endif %}

                </ul>
            </nav>



        </div>







    </header>



    <main class="container">
        {% block content %}{% endblock %}
    </main>

    <footer>
        <div class="container">
            <nav class="footer-links" aria-label="{% trans 'Footer navigation' %}">
                <div class="footer-col">
                    <a href="{% url 'main_app:business_soft' %}">{% trans "Business products" %}</a>
                    <a href="{% url 'main_app:cooperation' %}">{% trans "Cooperation" %}</a>
                    <a href="{% url 'main_app:contact' %}">{% trans "Contacts" %}</a>
                    <a href="{% url 'main_app:my_projects' %}">{% trans "My Projects" %}</a>
                </div>
                <div class="footer-col">
                    <a href="{% url 'main_app:cooperation' %}#ai-agents">{% trans "AI agents" %}</a>
                    <a href="{% url 'main_app:business_soft' %}">{% trans "CRM for dentistry" %}</a>
                    <a href="{% url 'main_app:free_soft_detail' slug='email-sender' %}">{% trans "Email sender" %}</a>
                    <a href="{% url 'main_app:requisites' %}">{% trans "Requisites" %}</a>
                </div>
            </nav>
            <p class="footer-copyright">{% trans 'Thank you for visiting my site' %}<br> &copy; LiuBA29 {% now "Y" %}</p>
        </div>
    </footer>

    <script>
        const themeToggle = document.getElementById('themeToggle');
        const currentTheme = localStorage.getItem('theme') || 'light-theme';
        document.body.classList.add(currentTheme);
        themeToggle.checked = currentTheme === 'dark-theme';

        // Скрипт изменения картинки логотипа при наведении и клике
    const logoLink = document.getElementById('logo-link');
    const logoImg = document.getElementById('logo-img');

    const originalSrc = 'https://res.cloudinary.com/dczzlelzw/image/upload/v1742906472/face1-re_y281rk.png';
    const altSrc = 'https://res.cloudinary.com/dczzlelzw/image/upload/v1751985098/uxqacxdfkqeq9l12gbv4.png';

    function applyDarkLogoMask() {
        if (!logoLink || !logoImg) return;
        if (document.body.classList.contains('dark-theme')) {
            const src = logoImg.src || originalSrc;
            logoLink.style.webkitMaskImage = 'url(' + src + ')';
            logoLink.style.maskImage = 'url(' + src + ')';
        } else {
            logoLink.style.webkitMaskImage = '';
            logoLink.style.maskImage = '';
        }
    }

    themeToggle.addEventListener('change', () => {
        const newTheme = themeToggle.checked ? 'dark-theme' : 'light-theme';
        document.body.classList.remove('light-theme', 'dark-theme');
        document.body.classList.add(newTheme);
        localStorage.setItem('theme', newTheme);
        applyDarkLogoMask();
    });

    applyDarkLogoMask();

   // Проверь, главная ли страница
const isHomePage = window.location.pathname === '{% url "main_app:home" %}';

let clicked = false;

if (!isHomePage) {
    logoLink.addEventListener('mouseenter', () => {
        if (!clicked) {
            logoImg.src = altSrc;
            applyDarkLogoMask();
        }
    });

    logoLink.addEventListener('mouseleave', () => {
        if (!clicked) {
            logoImg.src = originalSrc;
            applyDarkLogoMask();
        }
    });

    logoLink.addEventListener('click', (e) => {
        clicked = true;
        logoImg.src = altSrc;
        applyDarkLogoMask();
    });
}


    </script>

    {% block extra_js %}

{% endblock %}

<div id="cookie-banner">
    <span>{% trans "This site uses cookies to improve your experience" %}</span>
    <button id="accept-cookies" type="button">{% trans "Accept" %}</button>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        if (!localStorage.getItem("cookiesAccepted")) {
            setTimeout(() => {
                const banner = document.getElementById("cookie-banner");
                banner.style.display = "block";
                setTimeout(() => {
                    banner.style.opacity = "1";
                    banner.style.bottom = "30px"; // лёгкий подъём при появлении
                }, 50);
            }, 2000); // задержка 2 секунды
        }
        document.getElementById("accept-cookies").onclick = function() {
            localStorage.setItem("cookiesAccepted", "true");
            const banner = document.getElementById("cookie-banner");
            banner.style.opacity = "0";
            banner.style.bottom = "0px"; // уезжает вниз
            setTimeout(() => banner.style.display = "none", 800);
        };
    });
</script>








</body>
</html>
