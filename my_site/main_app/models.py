# main_app/models.py

from django.db import models
from cloudinary.models import CloudinaryField
from django.urls import reverse




from django.db import models

class PageView(models.Model):
    path = models.CharField(max_length=255, unique=True)
    views_count = models.PositiveIntegerField(default=0)
    last_viewed = models.DateTimeField(auto_now=True)

    def __str__(self):
        return f"{self.path} ‚Äî {self.views_count} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤"


class PageVisitLog(models.Model):
    path = models.CharField(max_length=255)
    viewed_at = models.DateTimeField(auto_now_add=True)
    ip_address = models.GenericIPAddressField()

    def __str__(self):
        return f"{self.viewed_at} - {self.path} - {self.ip_address}"



# üîπ –ú–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤
class Project(models.Model):
    title = models.CharField(max_length=200, verbose_name="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞")
    slug = models.SlugField(unique=True)
    description = models.TextField(verbose_name="–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞")
    tech_stack = models.CharField(max_length=255, verbose_name="–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏")  # –ù–∞–ø—Ä–∏–º–µ—Ä: Django, React, PostgreSQL
    repo_link = models.URLField(blank=True, null=True, verbose_name="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π")
    demo_link_ru = models.URLField(blank=True, null=True, verbose_name="–°—Å—ã–ª–∫–∞ –Ω–∞ –¥–µ–º–æ (ru)")
    demo_link_en = models.URLField(blank=True, null=True, verbose_name="–°—Å—ã–ª–∫–∞ –Ω–∞ –¥–µ–º–æ (en)")
    image = CloudinaryField('image', blank=True, null=True)
    created_at = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return self.title

    def get_absolute_url(self):
        return reverse('main_app:project_detail', kwargs={'slug':self.slug})

# üîπ –ú–æ–¥–µ–ª—å –¥–ª—è –ø–æ–ª–µ–∑–Ω–æ–≥–æ —Å–æ—Ñ—Ç–∞
class UsefulSoftware(models.Model):
    name = models.CharField(max_length=200, verbose_name="–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ—Ñ—Ç–∞")
    slug = models.SlugField(unique=True)
    description = models.TextField(verbose_name="–û–ø–∏—Å–∞–Ω–∏–µ")
    download_link = models.URLField(verbose_name="–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ", blank=True, null=True)
    english_link = models.URLField(verbose_name="English version link", blank=True, null=True)  # –ù–æ–≤–æ–µ –ø–æ–ª–µ
    download_link_backup = models.URLField(verbose_name="–†–µ–∑–µ—Ä–≤–Ω–∞—è —Å—Å—ã–ª–∫–∞ (RU)", blank=True, null=True)
    english_link_backup = models.URLField(verbose_name="–†–µ–∑–µ—Ä–≤–Ω–∞—è —Å—Å—ã–ª–∫–∞ (EN)", blank=True, null=True)
    author = models.CharField(
        max_length=200,
        default="Liubov Kovaleva @LiuBA29",
        verbose_name="–ê–≤—Ç–æ—Ä"
    )  # –ù–æ–≤–æ–µ –ø–æ–ª–µ
    created_at = models.DateTimeField(auto_now_add=True)
    image = CloudinaryField('image', blank=True, null=True)

    def __str__(self):
        return self.name

    def get_absolute_url(self):
        return reverse('main_app:useful_soft_detail', kwargs={'slug': self.slug})




# üîπ –ú–æ–¥–µ–ª—å –¥–ª—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –ª—é–¥–∏ –º–æ–≥–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è)
class ContactMessage(models.Model):
    name = models.CharField(max_length=100, verbose_name="–ò–º—è")
    email = models.EmailField(verbose_name="Email")
    message = models.TextField(verbose_name="–°–æ–æ–±—â–µ–Ω–∏–µ", blank=True, null=True)
    created_at = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return f"–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç {self.name} ({self.email})"

